apply plugin: 'com.android.application'

android {
    namespace "com.spmods.ytpro"  
    compileSdk 36

    defaultConfig {
        applicationId "com.spmods.ytpro"
        minSdkVersion 21
        targetSdkVersion 36
        versionCode 3
        versionName "1.2"
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

dependencies {
    implementation 'androidx.core:core-splashscreen:1.0.1'
    implementation 'pl.droidsonroids.gif:android-gif-drawable:1.2.28'
    implementation 'androidx.media:media:1.7.0'
    implementation 'com.google.android.exoplayer:exoplayer:2.19.1'
    implementation 'com.google.android.exoplayer:extension-mediasession:2.19.1'
}

// ========================================
// ğŸ” ENCRYPTION TASK
// ========================================

task encryptAssets(type: Exec) {
    description = 'Encrypt JS assets before building'
    group = 'build'
    
    workingDir rootProject.projectDir
    
    // Try python3 first, fallback to python
    def pythonCmd = System.getProperty('os.name').toLowerCase().contains('windows') ? 'python' : 'python3'
    
    commandLine pythonCmd, 'scripts/encrypt.py'
    
    // Ignore exit value to prevent build failure if already encrypted
    ignoreExitValue = false
    
    doFirst {
        println ''
        println 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
        println 'ğŸ” Encrypting Assets...'
        println 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
    }
    
    doLast {
        println 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
        println 'âœ… Assets Encrypted Successfully!'
        println 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'
        println ''
    }
}

// Build à¶šà¶»à¶± à¶šà·œà¶§ automatically encrypt à·€à·™à¶±à·Šà¶±
tasks.whenTaskAdded { task ->
    if (task.name == 'preBuild') {
        task.dependsOn encryptAssets
    }
}

// Clean à¶šà¶»à¶±à¶šà·œà¶§ encrypted files delete à¶šà¶»à¶±à·Šà¶±
clean.doLast {
    delete fileTree('app/src/main/assets') {
        include '*.enc'
    }
    println 'ğŸ—‘ï¸  Cleaned encrypted assets'
}
